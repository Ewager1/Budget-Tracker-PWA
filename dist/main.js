(()=>{let e,t=[];function n(){let e=t.reduce(((e,t)=>e+parseInt(t.value)),0);document.querySelector("#total").textContent=e}function o(){let e=document.querySelector("#tbody");e.innerHTML="",t.forEach((t=>{let n=document.createElement("tr");n.innerHTML=`\n      <td>${t.name}</td>\n      <td>${t.value}</td>\n    `,e.appendChild(n)}))}function a(){let n=t.slice().reverse(),o=0,a=n.map((e=>{let t=new Date(e.date);return`${t.getMonth()+1}/${t.getDate()}/${t.getFullYear()}`})),r=n.map((e=>(o+=parseInt(e.value),o)));e&&e.destroy();let c=document.getElementById("myChart").getContext("2d");e=new Chart(c,{type:"line",data:{labels:a,datasets:[{label:"Total Over Time",fill:!0,backgroundColor:"#6666ff",data:r}]}})}function r(e){let r=document.querySelector("#t-name"),c=document.querySelector("#t-amount"),l=document.querySelector(".form .error");if(""===r.value||""===c.value)return void(l.textContent="Missing Information");l.textContent="";let u={name:r.value,value:c.value,date:(new Date).toISOString()};e||(u.value*=-1),t.unshift(u),a(),o(),n(),fetch("/api/transaction",{method:"POST",body:JSON.stringify(u),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{e.errors?l.textContent="Missing Information":(r.value="",c.value="")})).catch((e=>{!function(e){const t=indexedDB.open("budget",1);t.onupgradeneeded=e=>{e.target.result.createObjectStore("budgetStore",{keyPath:"budgetId",autoIncrement:!0}).createIndex("name","name")},t.onsuccess=()=>{t.result.transaction(["budgetStore"],"readwrite").objectStore("budgetStore").add({name:e.name,value:e.value,date:e.date})}}(u),r.value="",c.value=""}))}window.addEventListener("online",(function(){const e=indexedDB.open("budget",1);e.onsuccess=()=>{const t=e.result.transaction(["budgetStore"],"readwrite").objectStore("budgetStore"),n=t.getAll();n.onsuccess=function(e){let o=n.result;t.clear(),fetch("/api/transaction/bulk",{method:"POST",body:JSON.stringify(o),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"}})}}})),fetch("/api/transaction").then((e=>e.json())).then((e=>{t=e,n(),o(),a(),console})),document.querySelector("#add-btn").onclick=function(){r(!0)},document.querySelector("#sub-btn").onclick=function(){r(!1)}})();